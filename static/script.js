class K{constructor(){this.i=document.getElementById('searchInput');this.r=document.getElementById('results');this.s=document.getElementById('searchStatus');this.m=document.getElementById('contentModal');this.t=document.getElementById('modalTitle');this.c=document.getElementById('modalContent');this.x=document.getElementById('closeModal');this.o=null;this.sel=0;this.init()}init(){this.i.oninput=()=>this.h();this.x.onclick=()=>this.hide();this.m.onclick=e=>e.target===this.m&&this.hide();onkeydown=e=>this.key(e);this.restore()}key(e){if(e.key=='Escape'){this.hide();return}if(e.target!=this.i)return;const rs=this.r.querySelectorAll('.result');if(!rs.length)return;if(e.key=='ArrowDown'){e.preventDefault();this.sel=Math.min(this.sel+1,rs.length-1);this.hl()}else if(e.key=='ArrowUp'){e.preventDefault();this.sel=Math.max(this.sel-1,0);this.hl()}else if(e.key=='Enter'&rs[this.sel]){e.preventDefault();rs[this.sel].click()}}hl(){const rs=this.r.querySelectorAll('.result');rs.forEach((r,i)=>r.classList.toggle('selected',i==this.sel))}restore(){const u=new URL(location);const q=u.searchParams.get('q');if(q){this.i.value=q;this.h()}}h(){clearTimeout(this.o);const q=this.i.value.trim();if(!q){this.w();this.s.textContent='ready';return}this.s.textContent='analyzing...';this.o=setTimeout(()=>this.p(q),300)}async p(q){try{const r=await fetch(`/search?q=${encodeURIComponent(q)}`);const d=await r.json();this.d(d,q)}catch(e){this.s.textContent='error'}finally{this.s.textContent='ready'}}d(r,q){this.sel=0;if(!r.length){this.r.innerHTML=`<div class="no-results"><h3>no results</h3><p>try different terms</p></div>`;history.replaceState({},'','/');return}this.r.innerHTML=r.map((x,i)=>`<div class="result" onclick="k.show('${x.file}')"><div class="note-header">${this.e(x.title)}</div><div class="note-snippet">${this.e(x.content.substring(0,60))}${x.content.length>60?'...':''}</div><div class="note-match">${Math.round(x.similarity*100)}%</div></div>`).join('');this.hl();history.replaceState({},'',`?q=${encodeURIComponent(q)}`)}w(){this.r.innerHTML=`<div class="welcome"><h3>semantic search</h3><p>contextual understanding</p><div class="features"><span class="feature">ai-powered</span><span class="feature">instant</span><span class="feature">private</span></div></div>`}async show(f){try{const r=await fetch(`/content/${encodeURIComponent(f)}`);const d=await r.json();if(d.error)return;this.t.textContent=d.title;this.c.innerHTML=d.content;this.m.style.display='block';document.body.style.overflow='hidden'}catch(e){}}hide(){this.m.style.display='none';document.body.style.overflow=''}e(t){const d=document.createElement('div');d.textContent=t;return d.innerHTML}}const k=new K();

function init(){const{floor:f,random:r}=Math;const s=document.querySelector('.circuit-bg');if(!s)return;const z=30,st='rgba(52,152,219,0.3)',bg='rgba(52,152,219,0.1)';const{width:w,height:h}=document.body.getBoundingClientRect();s.setAttribute('width',w);s.setAttribute('height',h);const rows=f(h/z),cols=f(w/z);for(let y=0;y<rows;y+=3)for(let x=0;x<cols;x+=3){const c=document.createElementNS('http://www.w3.org/2000/svg','circle');const px=x*z+z/2,py=y*z+z/2;c.setAttribute('cx',px);c.setAttribute('cy',py);c.setAttribute('r',r()*3+2);c.setAttribute('fill',st);c.setAttribute('opacity',r()*.5+.3);c.style.animation=`pulse ${r()*2+1}s ease-in-out infinite`;c.style.animationDelay=`${r()*2}s`;s.appendChild(c);if(r()>.7){const l=document.createElementNS('http://www.w3.org/2000/svg','line');l.setAttribute('x1',px);l.setAttribute('y1',py);l.setAttribute('x2',px+z*(r()>.5?1:-1));l.setAttribute('y2',py);l.setAttribute('stroke',bg);l.setAttribute('stroke-width',1);l.setAttribute('opacity',.4);s.appendChild(l)}}}setTimeout(init,100);
