class KnowledgeSearch{constructor(){this.searchInput=document.getElementById('searchInput');this.results=document.getElementById('results');this.status=document.getElementById('searchStatus');this.modal=document.getElementById('contentModal');this.modalTitle=document.getElementById('modalTitle');this.modalContent=document.getElementById('modalContent');this.closeModal=document.getElementById('closeModal');this.searchTimeout=null;this.init()}init(){this.searchInput.addEventListener('input',()=>this.handleSearch());this.closeModal.addEventListener('click',()=>this.hideModal());this.modal.addEventListener('click',e=>{if(e.target===this.modal)this.hideModal()});document.addEventListener('keydown',e=>{if(e.key==='Escape')this.hideModal()})}handleSearch(){clearTimeout(this.searchTimeout);const query=this.searchInput.value.trim();if(!query){this.showWelcome();this.status.textContent='';return}this.status.textContent='SEARCHING...';this.searchTimeout=setTimeout(()=>this.performSearch(query),300)}async performSearch(query){try{const response=await fetch(`/search?q=${encodeURIComponent(query)}`);const results=await response.json();this.displayResults(results,query)}catch(error){console.error('Search error:',error);this.status.textContent='SEARCH ERROR'}finally{this.status.textContent=''}}displayResults(results,query){if(!results.length){this.results.innerHTML=`<div class="no-results"><h3>NO RESULTS FOUND</h3><p>Try different search terms or verify your knowledge base</p></div>`;return}const html=`<div class="dots-grid">${results.map(result=>`<div class="dot" onclick="knowledgeSearch.showContent('${result.file}')" data-title="${this.escapeHtml(result.title)}" style="background: hsl(${Math.round(result.similarity*120)}, 30%, ${20+result.similarity*40}%)"></div>`).join('')}</div>`;this.results.innerHTML=html}showWelcome(){this.results.innerHTML=`<div class="welcome"><h3>A place for ideas to find each other</h3><p>Search understands meaning, not just words</p><div class="features"><span class="feature">semantic</span><span class="feature">lightweight</span><span class="feature">private</span></div></div>`}async showContent(filename){try{const response=await fetch(`/content/${encodeURIComponent(filename)}`);const data=await response.json();if(data.error){alert('Content not found');return}this.modalTitle.textContent=data.title;this.modalContent.innerHTML=data.content;this.modal.style.display='block';document.body.style.overflow='hidden'}catch(error){console.error('Content load error:',error);alert('Failed to load content')}}hideModal(){this.modal.style.display='none';document.body.style.overflow=''}escapeHtml(text){const div=document.createElement('div');div.textContent=text;return div.innerHTML}}const knowledgeSearch=new KnowledgeSearch();
